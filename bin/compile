#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>

BUILD_DIR=${1:-}
CACHE_DIR=${2:-}
ENV_DIR=${3:-}

echo "------> Generating .profile.d file to generate google-credentials.json at startup"
mkdir -p $BUILD_DIR/.profile.d

CREDENTIALS_JSON=$(cat ${ENV_DIR}/CREDENTIALS_JSON)
CREDENTIALS_JSON_NAME=$(cat ${ENV_DIR}/CREDENTIALS_JSON_NAME)

echo "echo ${CREDENTIALS_JSON@Q} > /app/${CREDENTIALS_JSON_NAME@Q}.json" > $BUILD_DIR/.profile.d/${CREDENTIALS_JSON_NAME@Q}.sh
chmod +x $BUILD_DIR/.profile.d/${CREDENTIALS_JSON_NAME@Q}.sh
